<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Razorpay Test Checkout</title>
    <!-- Razorpay SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #f4f4f4; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        button { background: #3399cc; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin-top: 20px; }
        button:hover { background: #2288bb; }
        .details { margin-top: 10px; color: #555; }
    </style>
</head>
<body>

<div class="card">
    <h2>Razorpay Integration Test</h2>
    <p>Using Dummy/Test Keys</p>
    <div class="details">
        <p><strong>Item:</strong> Demo Order</p>
        <p><strong>Amount:</strong> ₹100.00</p>
    </div>
    <button id="pay-btn">Pay ₹100</button>
</div>

<script>
    // 1. configuration
    // This Key ID must match what is in the backend if you want signature verification to pass.
    // However, for this demo, we just need it to open.
    const RAZORPAY_KEY_ID = "rzp_test_1DP5mmOlF5G5ag"; // Dummy/Test Key

    document.getElementById('pay-btn').onclick = async function(e) {
        e.preventDefault();
        
        try {
            // 2. Call Backend to create order
            console.log("Creating order...");
            const response = await fetch("http://localhost:8081/api/payment/create-order", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    amount: 100.0, // ₹100
                    currency: "INR"
                })
            });

            if (!response.ok) {
                alert("Backend Error: " + response.statusText);
                return;
            }

            const orderData = await response.json();
            console.log("Order Created:", orderData);

            // 3. Open Razorpay Checkout
            var options = {
                "key": RAZORPAY_KEY_ID, 
                "amount": orderData.amount * 100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": orderData.currency,
                "name": "Test Company",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                "order_id": orderData.orderId, 
                "handler": function (response){
                    alert("Payment Successful! Payment ID: " + response.razorpay_payment_id);
                    // Call verify endpoint here if needed
                },
                "prefill": {
                    "name": "Test User",
                    "email": "test.user@example.com",
                    "contact": "9999999999"
                },
                "theme": {
                   "color": "#3399cc"
                }
            };
            
            var rzp1 = new Razorpay(options);
            
            rzp1.on('payment.failed', function (response){
                    alert("Payment Failed code: " + response.error.code);
            });
            
            rzp1.open();

        } catch (err) {
            console.error(err);
            alert("Error: " + err.message);
        }
    }
</script>

</body>
</html>
